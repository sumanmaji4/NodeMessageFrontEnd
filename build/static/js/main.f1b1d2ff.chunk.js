(this["webpackJsonpnode-complete-social-network-prep"]=this["webpackJsonpnode-complete-social-network-prep"]||[]).push([[0],{145:function(t,e,n){},146:function(t,e,n){},148:function(t,e,n){},149:function(t,e,n){},150:function(t,e,n){},151:function(t,e,n){},152:function(t,e,n){},156:function(t,e,n){},157:function(t,e,n){},158:function(t,e,n){},159:function(t,e,n){},163:function(t,e,n){},164:function(t,e,n){},165:function(t,e,n){},166:function(t,e,n){},167:function(t,e,n){},168:function(t,e,n){},169:function(t,e,n){},170:function(t,e,n){},171:function(t,e){},175:function(t,e){},177:function(t,e){},189:function(t,e){},191:function(t,e){},218:function(t,e){},220:function(t,e){},221:function(t,e){},226:function(t,e){},228:function(t,e){},247:function(t,e){},259:function(t,e){},262:function(t,e){},266:function(t,e,n){"use strict";n.r(e);var o=n(2),a=n(39),s=n.n(a),i=n(270),r=(n(145),n(4)),c=n(6),l=n(7),d=n(8),u=n(9),h=n(271),p=n(137),j=n(269),m=n(272),g=(n(146),n(0)),b=function(t){return Object(g.jsxs)(o.Fragment,{children:[Object(g.jsx)("header",{className:"main-header",children:t.header}),t.mobileNav,Object(g.jsx)("main",{className:"content",children:t.children})]})},f=(n(148),function(t){return s.a.createPortal(Object(g.jsx)("div",{className:["backdrop",t.open?"open":""].join(" "),onClick:t.onClick}),document.getElementById("backdrop-root"))}),v=(n(149),function(t){return Object(g.jsx)("div",{className:"toolbar",children:t.children})}),O=n(268),x=(n(150),function(t){return Object(g.jsxs)("button",{className:"mobile-toggle",onClick:t.onOpen,children:[Object(g.jsx)("span",{className:"mobile-toggle__bar"}),Object(g.jsx)("span",{className:"mobile-toggle__bar"}),Object(g.jsx)("span",{className:"mobile-toggle__bar"})]})}),k=(n(151),function(t){return Object(g.jsx)("h1",{className:"logo",children:"MessageNode"})}),w=n(49),P=(n(152),[{id:"feed",text:"Feed",link:"/",auth:!0},{id:"login",text:"Login",link:"/",auth:!1},{id:"signup",text:"Signup",link:"/signup",auth:!1}]),C=function(t){return[].concat(Object(w.a)(P.filter((function(e){return e.auth===t.isAuth})).map((function(e){return Object(g.jsx)("li",{className:["navigation-item",t.mobile?"mobile":""].join(" "),children:Object(g.jsx)(O.a,{to:e.link,exact:!0,onClick:t.onChoose,children:e.text})},e.id)}))),[t.isAuth&&Object(g.jsx)("li",{className:"navigation-item",children:Object(g.jsx)("button",{onClick:t.onLogout,children:"Logout"})},"logout")])},S=(n(156),function(t){return Object(g.jsxs)("nav",{className:"main-nav",children:[Object(g.jsx)(x,{onOpen:t.onOpenMobileNav}),Object(g.jsx)("div",{className:"main-nav__logo",children:Object(g.jsx)(O.a,{to:"/",children:Object(g.jsx)(k,{})})}),Object(g.jsx)("div",{className:"spacer"}),Object(g.jsx)("ul",{className:"main-nav__items",children:Object(g.jsx)(C,{isAuth:t.isAuth,onLogout:t.onLogout})})]})}),F=(n(157),function(t){return Object(g.jsx)("nav",{className:["mobile-nav",t.open?"open":""].join(" "),children:Object(g.jsx)("ul",{className:["mobile-nav__items",t.mobile?"mobile":""].join(" "),children:Object(g.jsx)(C,{mobile:!0,onChoose:t.onChooseItem,isAuth:t.isAuth,onLogout:t.onLogout})})})}),H=n(86),N=(n(158),function(t){return t.link?Object(g.jsx)(H.a,{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),to:t.link,children:t.children}):Object(g.jsx)("button",{className:["button","button--".concat(t.design),"button--".concat(t.mode)].join(" "),onClick:t.onClick,disabled:t.disabled||t.loading,type:t.type,children:t.loading?"Loading...":t.children})}),y=(n(159),function(t){return s.a.createPortal(Object(g.jsxs)("div",{className:"modal",children:[Object(g.jsx)("header",{className:"modal__header",children:Object(g.jsx)("h1",{children:t.title})}),Object(g.jsx)("div",{className:"modal__content",children:t.children}),Object(g.jsxs)("div",{className:"modal__actions",children:[Object(g.jsx)(N,{design:"danger",mode:"flat",onClick:t.onCancelModal,children:"Cancel"}),Object(g.jsx)(N,{mode:"raised",onClick:t.onAcceptModal,disabled:!t.acceptEnabled,loading:t.isLoading,children:"Accept"})]})]}),document.getElementById("modal-root"))}),_=function(t){return Object(g.jsxs)(o.Fragment,{children:[t.error&&Object(g.jsx)(f,{onClick:t.onHandle}),t.error&&Object(g.jsx)(y,{title:"An Error Occurred",onCancelModal:t.onHandle,onAcceptModal:t.onHandle,acceptEnabled:!0,children:Object(g.jsx)("p",{children:t.error.message})})]})},E=n(140),A=(n(163),function(t){return Object(g.jsxs)("article",{className:"post",children:[Object(g.jsxs)("header",{className:"post__header",children:[Object(g.jsxs)("h3",{className:"post__meta",children:["Posted by ",t.author," on ",t.date]}),Object(g.jsx)("h1",{className:"post__title",children:t.title})]}),Object(g.jsxs)("div",{className:"post__actions",children:[Object(g.jsx)(N,{mode:"flat",link:t.id,children:"View"}),Object(g.jsx)(N,{mode:"flat",onClick:t.onStartEdit,children:"Edit"}),Object(g.jsx)(N,{mode:"flat",design:"danger",onClick:t.onDelete,children:"Delete"})]})]})}),I=n(23),L=n(28),B=(n(88),function(t){return Object(g.jsxs)("div",{className:"input",children:[t.label&&Object(g.jsx)("label",{htmlFor:t.id,children:t.label}),"input"===t.control&&Object(g.jsx)("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:t.type,id:t.id,required:t.required,value:t.value,placeholder:t.placeholder,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur}),"textarea"===t.control&&Object(g.jsx)("textarea",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),id:t.id,rows:t.rows,required:t.required,value:t.value,onChange:function(e){return t.onChange(t.id,e.target.value)},onBlur:t.onBlur})]})}),D=function(t){return Object(g.jsxs)("div",{className:"input",children:[Object(g.jsx)("label",{htmlFor:t.id,children:t.label}),Object(g.jsx)("input",{className:[t.valid?"valid":"invalid",t.touched?"touched":"untouched"].join(" "),type:"file",id:t.id,onChange:function(e){return t.onChange(t.id,e.target.value,e.target.files)},onBlur:t.onBlur})]})},T=(n(164),function(t){return Object(g.jsx)("div",{className:"image",style:{backgroundImage:"url('".concat(t.imageUrl,"')"),backgroundSize:t.contain?"contain":"cover",backgroundPosition:t.left?"left":"center"}})}),M=function(t){return""!==t.trim()},U=function(t){return function(e){var n=!0;return t.min&&(n=n&&e.trim().length>=t.min),t.max&&(n=n&&e.trim().length<=t.max),n}},z=function(t){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)},V={title:{value:"",valid:!1,touched:!1,validators:[M,U({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[M]},content:{value:"",valid:!1,touched:!1,validators:[M,U({min:5})]}},R=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={postForm:V,formIsValid:!1,imagePreview:null},t.postInputChangeHandler=function(e,n,o){o&&function(t){var e=new FileReader,n=new Promise((function(t,n){e.onload=function(e){return t(e.target.result)},e.onerror=function(t){return n(t)}}));return e.readAsDataURL(t),n}(o[0]).then((function(e){t.setState({imagePreview:e})})).catch((function(e){t.setState({imagePreview:null})})),t.setState((function(t){var a,s=!0,i=Object(L.a)(t.postForm[e].validators);try{for(i.s();!(a=i.n()).done;){var c=a.value;s=s&&c(n)}}catch(h){i.e(h)}finally{i.f()}var l=Object(r.a)(Object(r.a)({},t.postForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.postForm[e]),{},{valid:s,value:o?o[0]:n}))),d=!0;for(var u in l)d=d&&l[u].valid;return{postForm:l,formIsValid:d}}))},t.inputBlurHandler=function(e){t.setState((function(t){return{postForm:Object(r.a)(Object(r.a)({},t.postForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.postForm[e]),{},{touched:!0})))}}))},t.cancelPostChangeHandler=function(){t.setState({postForm:V,formIsValid:!1}),t.props.onCancelEdit()},t.acceptPostChangeHandler=function(){var e={title:t.state.postForm.title.value,image:t.state.postForm.image.value,content:t.state.postForm.content.value};t.props.onFinishEdit(e),t.setState({postForm:V,formIsValid:!1,imagePreview:null})},t}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(t,e){if(this.props.editing&&t.editing!==this.props.editing&&t.selectedPost!==this.props.selectedPost){var n={title:Object(r.a)(Object(r.a)({},e.postForm.title),{},{value:this.props.selectedPost.title,valid:!0}),image:Object(r.a)(Object(r.a)({},e.postForm.image),{},{value:this.props.selectedPost.imagePath,valid:!0}),content:Object(r.a)(Object(r.a)({},e.postForm.content),{},{value:this.props.selectedPost.content,valid:!0})};this.setState({postForm:n,formIsValid:!0})}}},{key:"render",value:function(){return this.props.editing?Object(g.jsxs)(o.Fragment,{children:[Object(g.jsx)(f,{onClick:this.cancelPostChangeHandler}),Object(g.jsx)(y,{title:"New Post",acceptEnabled:this.state.formIsValid,onCancelModal:this.cancelPostChangeHandler,onAcceptModal:this.acceptPostChangeHandler,isLoading:this.props.loading,children:Object(g.jsxs)("form",{children:[Object(g.jsx)(B,{id:"title",label:"Title",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"title"),valid:this.state.postForm.title.valid,touched:this.state.postForm.title.touched,value:this.state.postForm.title.value}),Object(g.jsx)(D,{id:"image",label:"Image",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"image"),valid:this.state.postForm.image.valid,touched:this.state.postForm.image.touched}),Object(g.jsxs)("div",{className:"new-post__preview-image",children:[!this.state.imagePreview&&Object(g.jsx)("p",{children:"Please choose an image."}),this.state.imagePreview&&Object(g.jsx)(T,{imageUrl:this.state.imagePreview,contain:!0,left:!0})]}),Object(g.jsx)(B,{id:"content",label:"Content",control:"textarea",rows:"5",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"content"),valid:this.state.postForm.content.valid,touched:this.state.postForm.content.touched,value:this.state.postForm.content.value})]})})]}):null}}]),n}(o.Component),J=R,q=(n(165),function(t){return Object(g.jsxs)("div",{className:"paginator",children:[t.children,Object(g.jsxs)("div",{className:"paginator__controls",children:[t.currentPage>1&&Object(g.jsx)("button",{className:"paginator__control",onClick:t.onPrevious,children:"Previous"}),t.currentPage<t.lastPage&&Object(g.jsx)("button",{className:"paginator__control",onClick:t.onNext,children:"Next"})]})]})}),K=(n(166),function(t){return Object(g.jsxs)("div",{className:"loader",children:[Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{}),Object(g.jsx)("div",{})]})}),Y=(n(167),function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={isEditing:!1,posts:[],totalPosts:0,editPost:null,status:"",postPage:1,postsLoading:!0,editLoading:!1},t.addPost=function(e){t.setState((function(t){var n=Object(w.a)(t.posts);return 1===t.postPage&&(t.posts.length>=2&&n.pop(),n.unshift(e)),{posts:n,totalPosts:t.totalPosts+1}}))},t.updatePost=function(e){t.setState((function(t){var n=Object(w.a)(t.posts),o=n.findIndex((function(t){return t._id===e._id}));return o>-1&&(n[o]=e),{posts:n}}))},t.loadPosts=function(e){e&&t.setState({postsLoading:!0,posts:[]});var n=t.state.postPage;"next"===e&&(n++,t.setState({postPage:n})),"previous"===e&&(n--,t.setState({postPage:n})),fetch("https://nodemessagebackend.onrender.com/feed/posts?page="+n,{headers:{Authorization:"Bearer "+t.props.token}}).then((function(t){if(200!==t.status)throw new Error("Failed to fetch posts.");return t.json()})).then((function(e){t.setState({posts:e.posts.map((function(t){return Object(r.a)(Object(r.a)({},t),{},{imagePath:t.imageUrl})})),totalPosts:e.totalItems,postsLoading:!1})})).catch(t.catchError)},t.statusUpdateHandler=function(e){e.preventDefault(),fetch("https://nodemessagebackend.onrender.com/auth/status",{method:"PATCH",headers:{Authorization:"Bearer "+t.props.token,"Content-Type":"application/json"},body:JSON.stringify({status:t.state.status})}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Can't update status!");return t.json()})).then((function(t){console.log(t)})).catch(t.catchError)},t.newPostHandler=function(){t.setState({isEditing:!0})},t.startEditPostHandler=function(e){t.setState((function(t){return{isEditing:!0,editPost:Object(r.a)({},t.posts.find((function(t){return t._id===e})))}}))},t.cancelEditHandler=function(){t.setState({isEditing:!1,editPost:null})},t.finishEditHandler=function(e){t.setState({editLoading:!0});var n=new FormData;n.append("title",e.title),n.append("content",e.content),n.append("image",e.image);var o="https://nodemessagebackend.onrender.com/feed/post",a="POST";t.state.editPost&&(o="https://nodemessagebackend.onrender.com/feed/post/"+t.state.editPost._id,console.log(o),a="PUT"),fetch(o,{method:a,body:n,headers:{Authorization:"Bearer "+t.props.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Creating or editing a post failed!");return t.json()})).then((function(e){console.log("finishEditHandler->postData -------------\n",e,"\n\n");e.post._id,e.post.title,e.post.content,e.post.creator,e.post.createdAt;t.setState((function(t){return{isEditing:!1,editPost:null,editLoading:!1}}))})).catch((function(e){console.log(e),t.setState({isEditing:!1,editPost:null,editLoading:!1,error:e})}))},t.statusInputChangeHandler=function(e,n){t.setState({status:n})},t.deletePostHandler=function(e){t.setState({postsLoading:!0}),fetch("https://nodemessagebackend.onrender.com/feed/post/"+e,{method:"DELETE",headers:{Authorization:"Bearer "+t.props.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Deleting a post failed!");return t.json()})).then((function(e){console.log(e),t.loadPosts()})).catch((function(e){console.log(e),t.setState({postsLoading:!1})}))},t.errorHandler=function(){t.setState({error:null})},t.catchError=function(e){t.setState({error:e})},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var t=this;fetch("https://nodemessagebackend.onrender.com/auth/status",{headers:{Authorization:"Bearer "+this.props.token}}).then((function(t){if(200!==t.status)throw new Error("Failed to fetch user status.");return t.json()})).then((function(e){t.setState({status:e.status})})).catch(this.catchError),this.loadPosts(),Object(E.a)("https://nodemessagebackend.onrender.com/").on("posts",(function(e){"create"===e.action?t.addPost(e.post):"update"===e.action?t.updatePost(e.post):"delete"===e.action&&t.loadPosts()}))}},{key:"render",value:function(){var t=this;return Object(g.jsxs)(o.Fragment,{children:[Object(g.jsx)(_,{error:this.state.error,onHandle:this.errorHandler}),Object(g.jsx)(J,{editing:this.state.isEditing,selectedPost:this.state.editPost,loading:this.state.editLoading,onCancelEdit:this.cancelEditHandler,onFinishEdit:this.finishEditHandler}),Object(g.jsx)("section",{className:"feed__status",children:Object(g.jsxs)("form",{onSubmit:this.statusUpdateHandler,children:[Object(g.jsx)(B,{type:"text",placeholder:"Your status",control:"input",onChange:this.statusInputChangeHandler,value:this.state.status}),Object(g.jsx)(N,{mode:"flat",type:"submit",children:"Update"})]})}),Object(g.jsx)("section",{className:"feed__control",children:Object(g.jsx)(N,{mode:"raised",design:"accent",onClick:this.newPostHandler,children:"New Post"})}),Object(g.jsxs)("section",{className:"feed",children:[this.state.postsLoading&&Object(g.jsx)("div",{style:{textAlign:"center",marginTop:"2rem"},children:Object(g.jsx)(K,{})}),this.state.posts.length<=0&&!this.state.postsLoading?Object(g.jsx)("p",{style:{textAlign:"center"},children:"No posts found."}):null,!this.state.postsLoading&&Object(g.jsx)(q,{onPrevious:this.loadPosts.bind(this,"previous"),onNext:this.loadPosts.bind(this,"next"),lastPage:Math.ceil(this.state.totalPosts/2),currentPage:this.state.postPage,children:this.state.posts.map((function(e){return Object(g.jsx)(A,{id:e._id,author:e.creator.name,date:new Date(e.createdAt).toLocaleDateString("en-US"),title:e.title,image:e.imageUrl,content:e.content,onStartEdit:t.startEditPostHandler.bind(t,e._id),onDelete:t.deletePostHandler.bind(t,e._id)},e._id)}))})]})]})}}]),n}(o.Component)),W=Y,$=(n(168),function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={title:"",author:"",date:"",image:"",content:""},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props.match.params.postId;fetch("https://nodemessagebackend.onrender.com/feed/post/"+e,{headers:{Authorization:"Bearer "+this.props.token}}).then((function(t){if(200!==t.status)throw new Error("Failed to fetch status");return t.json()})).then((function(e){t.setState({title:e.post.title,author:e.post.creator.name,date:new Date(e.post.createdAt).toLocaleDateString("en-US"),image:"https://nodemessagebackend.onrender.com/"+e.post.imageUrl,content:e.post.content})})).catch((function(t){console.log(t)}))}},{key:"render",value:function(){return Object(g.jsxs)("section",{className:"single-post",children:[Object(g.jsx)("h1",{children:this.state.title}),Object(g.jsxs)("h2",{children:["Created by ",this.state.author," on ",this.state.date]}),Object(g.jsx)("div",{className:"single-post__image",children:Object(g.jsx)(T,{contain:!0,imageUrl:this.state.image})}),Object(g.jsx)("p",{children:this.state.content})]})}}]),n}(o.Component)),G=$,Q=(n(169),function(t){return Object(g.jsx)("section",{className:"auth-form",children:t.children})}),X=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={loginForm:{email:{value:"",valid:!1,touched:!1,validators:[M,z]},password:{value:"",valid:!1,touched:!1,validators:[M,U({min:5})]},formIsValid:!1}},t.inputChangeHandler=function(e,n){t.setState((function(t){var o,a=!0,s=Object(L.a)(t.loginForm[e].validators);try{for(s.s();!(o=s.n()).done;){var i=o.value;a=a&&i(n)}}catch(u){s.e(u)}finally{s.f()}var c=Object(r.a)(Object(r.a)({},t.loginForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.loginForm[e]),{},{valid:a,value:n}))),l=!0;for(var d in c)l=l&&c[d].valid;return{loginForm:c,formIsValid:l}}))},t.inputBlurHandler=function(e){t.setState((function(t){return{loginForm:Object(r.a)(Object(r.a)({},t.loginForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.loginForm[e]),{},{touched:!0})))}}))},t}return Object(l.a)(n,[{key:"render",value:function(){var t=this;return Object(g.jsx)(Q,{children:Object(g.jsxs)("form",{onSubmit:function(e){return t.props.onLogin(e,{email:t.state.loginForm.email.value,password:t.state.loginForm.password.value})},children:[Object(g.jsx)(B,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.loginForm.email.value,valid:this.state.loginForm.email.valid,touched:this.state.loginForm.email.touched}),Object(g.jsx)(B,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.loginForm.password.value,valid:this.state.loginForm.password.valid,touched:this.state.loginForm.password.touched}),Object(g.jsx)(N,{design:"raised",type:"submit",loading:this.props.loading,children:"Login"})]})})}}]),n}(o.Component),Z=X,tt=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={signupForm:{email:{value:"",valid:!1,touched:!1,validators:[M,z]},password:{value:"",valid:!1,touched:!1,validators:[M,U({min:5})]},name:{value:"",valid:!1,touched:!1,validators:[M]},formIsValid:!1}},t.inputChangeHandler=function(e,n){t.setState((function(t){var o,a=!0,s=Object(L.a)(t.signupForm[e].validators);try{for(s.s();!(o=s.n()).done;){var i=o.value;a=a&&i(n)}}catch(u){s.e(u)}finally{s.f()}var c=Object(r.a)(Object(r.a)({},t.signupForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.signupForm[e]),{},{valid:a,value:n}))),l=!0;for(var d in c)l=l&&c[d].valid;return{signupForm:c,formIsValid:l}}))},t.inputBlurHandler=function(e){t.setState((function(t){return{signupForm:Object(r.a)(Object(r.a)({},t.signupForm),{},Object(I.a)({},e,Object(r.a)(Object(r.a)({},t.signupForm[e]),{},{touched:!0})))}}))},t}return Object(l.a)(n,[{key:"render",value:function(){var t=this;return Object(g.jsx)(Q,{children:Object(g.jsxs)("form",{onSubmit:function(e){return t.props.onSignup(e,t.state)},children:[Object(g.jsx)(B,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.signupForm.email.value,valid:this.state.signupForm.email.valid,touched:this.state.signupForm.email.touched}),Object(g.jsx)(B,{id:"name",label:"Your Name",type:"text",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"name"),value:this.state.signupForm.name.value,valid:this.state.signupForm.name.valid,touched:this.state.signupForm.name.touched}),Object(g.jsx)(B,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.signupForm.password.value,valid:this.state.signupForm.password.valid,touched:this.state.signupForm.password.touched}),Object(g.jsx)(N,{design:"raised",type:"submit",loading:this.props.loading,children:"Signup"})]})})}}]),n}(o.Component),et=tt,nt=(n(170),n(63)),ot=n.n(nt);ot.a.config();var at=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={showBackdrop:!1,showMobileNav:!1,isAuth:!1,token:null,userId:null,authLoading:!1,error:null},t.mobileNavHandler=function(e){t.setState({showMobileNav:e,showBackdrop:e})},t.backdropClickHandler=function(){t.setState({showBackdrop:!1,showMobileNav:!1,error:null})},t.logoutHandler=function(){t.setState({isAuth:!1,token:null}),localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId")},t.loginHandler=function(e,n){e.preventDefault(),t.setState({authLoading:!0}),fetch("https://nodemessagebackend.onrender.com/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n.email,password:n.password})}).then((function(t){if(422===t.status)throw new Error("Validation failed.");if(200!==t.status&&201!==t.status)throw console.log("Error!"),new Error("Could not authenticate you!");return t.json()})).then((function(e){console.log(e),t.setState({isAuth:!0,token:e.token,authLoading:!1,userId:e.userId}),localStorage.setItem("token",e.token),localStorage.setItem("userId",e.userId);var n=36e5,o=new Date((new Date).getTime()+n);localStorage.setItem("expiryDate",o.toISOString()),t.setAutoLogout(n)})).catch((function(e){console.log(e),t.setState({isAuth:!1,authLoading:!1,error:e})}))},t.signupHandler=function(e,n){console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_HOST_SITE:"https://nodemessagebackend.onrender.com/",REACT_APP_OK:"oooooooookkkkkkkkkkkkkk"})),e.preventDefault(),t.setState({authLoading:!0}),fetch("https://nodemessagebackend.onrender.com/auth/signup",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n.signupForm.email.value,password:n.signupForm.password.value,name:n.signupForm.name.value})}).then((function(t){if(422===t.status)throw new Error("Validation failed. Make sure the email address isn't used yet!");if(200!==t.status&&201!==t.status)throw console.log("Error!"),new Error("Creating a user failed!");return t.json()})).then((function(e){console.log(e),t.setState({isAuth:!1,authLoading:!1}),t.props.history.replace("/")})).catch((function(e){console.log(e),t.setState({isAuth:!1,authLoading:!1,error:e})}))},t.setAutoLogout=function(e){setTimeout((function(){t.logoutHandler()}),e)},t.errorHandler=function(){t.setState({error:null})},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var t=localStorage.getItem("token"),e=localStorage.getItem("expiryDate");if(t&&e)if(new Date(e)<=new Date)this.logoutHandler();else{var n=localStorage.getItem("userId"),o=new Date(e).getTime()-(new Date).getTime();this.setState({isAuth:!0,token:t,userId:n}),this.setAutoLogout(o)}}},{key:"render",value:function(){var t=this,e=Object(g.jsxs)(h.a,{children:[Object(g.jsx)(p.a,{path:"/",exact:!0,render:function(e){return Object(g.jsx)(Z,Object(r.a)(Object(r.a)({},e),{},{onLogin:t.loginHandler,loading:t.state.authLoading}))}}),Object(g.jsx)(p.a,{path:"/signup",exact:!0,render:function(e){return Object(g.jsx)(et,Object(r.a)(Object(r.a)({},e),{},{onSignup:t.signupHandler,loading:t.state.authLoading}))}}),Object(g.jsx)(j.a,{to:"/"})]});return this.state.isAuth&&(e=Object(g.jsxs)(h.a,{children:[Object(g.jsx)(p.a,{path:"/",exact:!0,render:function(e){return Object(g.jsx)(W,{userId:t.state.userId,token:t.state.token})}}),Object(g.jsx)(p.a,{path:"/:postId",render:function(e){return Object(g.jsx)(G,Object(r.a)(Object(r.a)({},e),{},{userId:t.state.userId,token:t.state.token}))}}),Object(g.jsx)(j.a,{to:"/"})]})),Object(g.jsxs)(o.Fragment,{children:[this.state.showBackdrop&&Object(g.jsx)(f,{onClick:this.backdropClickHandler}),Object(g.jsx)(_,{error:this.state.error,onHandle:this.errorHandler}),Object(g.jsx)(b,{header:Object(g.jsx)(v,{children:Object(g.jsx)(S,{onOpenMobileNav:this.mobileNavHandler.bind(this,!0),onLogout:this.logoutHandler,isAuth:this.state.isAuth})}),mobileNav:Object(g.jsx)(F,{open:this.state.showMobileNav,mobile:!0,onChooseItem:this.mobileNavHandler.bind(this,!1),onLogout:this.logoutHandler,isAuth:this.state.isAuth})}),e]})}}]),n}(o.Component),st=Object(m.a)(at);ot.a.config(),s.a.render(Object(g.jsx)(i.a,{children:Object(g.jsx)(st,{})}),document.getElementById("root"))},88:function(t,e,n){}},[[266,1,2]]]);
//# sourceMappingURL=main.f1b1d2ff.chunk.js.map